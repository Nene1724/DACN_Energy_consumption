<!-- Deployment View -->
<div id="deployment_view" class="hidden">
    <div id="alert_container" class="alert-stack"></div>

    <div class="grid">
        <div class="col-left">
            <div class="panel">
                <div class="panel-header">
                    <div>
                        <h3>Balena Cloud</h3>
                        <p class="muted">Select device and deploy models</p>
                    </div>
                    <button class="btn ghost" id="balena_refresh_btn" type="button">Refresh</button>
                </div>
                
                <!-- Fleet and device filters -->
                <div class="form-grid" style="margin-bottom: 14px;">
                    <div class="form-control">
                        <label for="balena_app_filter">Fleet</label>
                        <select id="balena_app_filter" class="filter-select" style="width: 100%;">
                            <option value="">All fleets</option>
                        </select>
                    </div>
                    <label style="display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 13px; margin-top: 8px; cursor: pointer;">
                        <input type="checkbox" id="balena_online_only" style="width: 16px; height: 16px; cursor: pointer;">
                        Show online only
                    </label>
                </div>
                
                <!-- Device selector -->
                <div class="form-grid">
                    <div class="form-control">
                        <label for="deploy_device_list">Devices</label>
                        <div id="deploy_device_list" class="device-list">
                            <div style="text-align: center; padding: 30px 20px; color: var(--muted); font-size: 13px;">
                                <div style="font-size: 32px; margin-bottom: 8px; opacity: 0.5;">ðŸ“¡</div>
                                Click "Refresh" button above to load devices
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; padding: 8px 12px; background: rgba(59, 130, 246, 0.05); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.15);">
                            <small class="text-muted" style="font-size: 12px; color: var(--muted);">
                                Selected
                            </small>
                            <strong id="selected_devices_count" style="font-size: 16px; color: var(--accent); font-weight: 700;">0</strong>
                        </div>
                    </div>
                    
                    <!-- Device specifications -->
                    <div id="device_specs" class="selection-preview" style="margin-top: 8px; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong id="device_specs_name">Device Name</strong>
                            <span class="badge ok" id="device_specs_status">ONLINE</span>
                        </div>
                        <div style="color: var(--muted); font-size: 13px; display: flex; flex-direction: column; gap: 4px;">
                            <div><strong>Type:</strong> <span id="device_specs_type">â€”</span></div>
                            <div><strong>OS:</strong> <span id="device_specs_os">â€”</span></div>
                            <div><strong>Specs:</strong> <span id="device_specs_hardware">â€”</span></div>
                            <div><strong>UUID:</strong> <span id="device_specs_uuid" style="font-family: monospace; font-size: 11px;">â€”</span></div>
                        </div>
                    </div>
                    
                    <!-- Load models button -->
                    <div style="display:flex; gap:10px; margin-top: 14px;">
                        <button class="btn primary full" onclick="loadAllModels()" style="font-weight: 600; padding: 14px;">
                            Load Models
                        </button>
                    </div>
                </div>
                
                <!-- Status process -->
                <div class="status-row" style="margin-top: 16px;">
                    <div class="status-block" id="process_status">
                        <div class="status-title" style="font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                        <div class="status-value" id="deployment_status_value" style="margin-top: 8px;">
                            <span class="dot idle" id="deployment_status_dot"></span>
                            <span id="deployment_status_text" style="font-weight: 500;">Ready</span>
                        </div>
                        <div id="deployment_progress" class="progress-bar-container" style="display: none; margin-top: 8px;">
                            <div class="progress-bar-fill" id="deployment_progress_bar" style="width: 0%;"></div>
                            <small id="deployment_progress_text" class="text-muted" style="display: block; margin-top: 4px;"></small>
                        </div>
                    </div>
                    <div class="status-block" id="model_status">
                        <div class="status-title" style="font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Model</div>
                        <div class="status-value" id="current_model_value" style="margin-top: 8px;">
                            <span id="current_model_name" style="font-weight: 600; color: var(--accent);">No model deployed</span>
                        </div>
                        <small class="text-muted" id="model_deployment_time" style="display: block; margin-top: 6px; font-size: 11px;"></small>
                    </div>
                </div>
                
                <!-- Device Model Status -->
                <div class="panel" id="device_model_status_panel" style="margin-top: 16px; display: none;">
                    <div class="panel-header">
                        <div>
                            <h3>Device Model Status</h3>
                            <p class="muted" style="font-size: 12px; margin-top: 4px;">Real-time status of deployed models</p>
                        </div>
                        <button class="btn ghost" onclick="refreshDeviceModelStatus()" style="font-size: 12px; padding: 6px 12px;">Refresh</button>
                    </div>
                    <div id="device_model_status_list" style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                
                <div class="status-block" id="rerun_container" style="margin-top:8px; display:none;">
                    <button class="btn primary full" id="rerun_btn" type="button">Re-run last deployment</button>
                    <p class="muted" id="rerun_caption" style="font-size:12px; margin-top:6px;">â€”</p>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div>
                        <h3>Device Telemetry</h3>
                        <p class="muted" style="font-size:12px; margin-top:4px;">Last update: <span id="deploy_metrics_last_update">â€”</span></p>
                    </div>
                </div>
                <div id="deploy_metrics_container" class="telemetry-grid"></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h3>Energy Prediction</h3>
                </div>
                <p class="muted" style="font-size:13px; margin-bottom:10px;">Fill the metadata and predict the energy consumption of your model</p>
                
                <!-- Common model selector -->
                <div class="form-control" style="margin-bottom: 12px;">
                    <label for="common_model_selector">Quick select popular model</label>
                    <select id="common_model_selector" class="filter-select" style="width: 100%;">
                        <option value="">Choose a model...</option>
                        <optgroup label="Lightweight Models">
                            <option value="mobilenet_v2">MobileNetV2 (3.5M params, ~14 mWh)</option>
                            <option value="mobilenet_v3_small">MobileNetV3-Small (2.5M params, ~10 mWh)</option>
                            <option value="shufflenet_v2">ShuffleNetV2 (2.3M params, ~12 mWh)</option>
                            <option value="squeezenet">SqueezeNet (1.2M params, ~8 mWh)</option>
                        </optgroup>
                        <optgroup label="Medium Models">
                            <option value="resnet18">ResNet18 (11.7M params, ~45 mWh)</option>
                            <option value="resnet34">ResNet34 (21.8M params, ~85 mWh)</option>
                            <option value="efficientnet_b0">EfficientNet-B0 (5.3M params, ~22 mWh)</option>
                            <option value="densenet121">DenseNet121 (8.0M params, ~35 mWh)</option>
                        </optgroup>
                        <optgroup label="Large Models">
                            <option value="resnet50">ResNet50 (25.6M params, ~120 mWh)</option>
                            <option value="resnet101">ResNet101 (44.5M params, ~210 mWh)</option>
                            <option value="efficientnet_b3">EfficientNet-B3 (12M params, ~68 mWh)</option>
                            <option value="vgg16">VGG16 (138M params, ~550 mWh)</option>
                        </optgroup>
                        <optgroup label="Detection Models">
                            <option value="yolov5s">YOLOv5s (7.2M params, ~32 mWh)</option>
                            <option value="yolov5m">YOLOv5m (21.2M params, ~95 mWh)</option>
                            <option value="yolov8n">YOLOv8n (3.2M params, ~18 mWh)</option>
                            <option value="yolov8s">YOLOv8s (11.2M params, ~48 mWh)</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="predict-grid">
                    <div class="form-control">
                        <label>Params (M)</label>
                        <input type="number" step="0.01" id="pred_params_m" placeholder="Auto-filled" readonly>
                    </div>
                    <div class="form-control">
                        <label>GFLOPs</label>
                        <input type="number" step="0.01" id="pred_gflops" placeholder="Auto-filled" readonly>
                    </div>
                    <div class="form-control">
                        <label>GMACs</label>
                        <input type="number" step="0.01" id="pred_gmacs" placeholder="Auto-filled" readonly>
                    </div>
                    <div class="form-control">
                        <label>Size (MB)</label>
                        <input type="number" step="0.01" id="pred_size_mb" placeholder="Auto-filled" readonly>
                    </div>
                    <div class="form-control">
                        <label>Latency (s)</label>
                        <input type="number" step="0.0001" id="pred_latency" placeholder="Auto-filled" readonly>
                    </div>
                    <div class="form-control">
                        <label>Throughput (iter/s)</label>
                        <input type="number" step="0.0001" id="pred_throughput" placeholder="Auto-filled" readonly>
                    </div>
                </div>
                <div class="predict-output" id="predict_output">Fill the fields and click "Predict".</div>
            </div>
        </div>

        <div class="col-right">
            <div class="panel">
                <div class="panel-header">
                    <div>
                        <h3>Available Models</h3>
                        <div class="inline-stats">
                            <span>Total <strong id="stat_total">0</strong></span>
                            <span>Under 50mWh <strong id="stat_50">0</strong></span>
                            <span>Under 100mWh <strong id="stat_100">0</strong></span>
                        </div>
                    </div>
                    <div class="panel-actions">
                        <input type="text" id="search_input" placeholder="Search models..." style="padding:10px 12px; border:1px solid var(--border); border-radius:8px; font-size:13px; width:200px;">
                        <select id="filter_select" class="filter-select">
                            <option value="all">All models</option>
                            <option value="recommended">Recommended</option>
                            <option value="under_50">Under 50 mWh</option>
                            <option value="under_100">Under 100 mWh</option>
                        </select>
                    </div>
                </div>
                <div class="model-grid" id="model_grid">
                    <div class="loading-placeholder">Loading models...</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div>
                        <h3>Deployment Logs</h3>
                        <p class="muted" style="font-size:12px; margin-top:4px;">Last 50 deployments</p>
                    </div>
                    <button class="btn ghost" id="logs_refresh_btn">Refresh</button>
                </div>
                <div id="logs_container" class="log-list"></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div>
                        <h3>Device Logs</h3>
                    </div>
                    <div class="panel-actions">
                        <button class="btn ghost" id="logs_refresh_btn_standalone">Refresh logs</button>
                    </div>
                </div>
                <div class="form-control" style="margin-bottom: 12px;">
                    <label for="device_logs_selector">Select device</label>
                    <select id="device_logs_selector" class="filter-select" style="width: 100%;">
                        <option value="">Choose a device...</option>
                    </select>
                </div>
                <div class="logs-container">
                    <div class="logs-header">
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 8px; color: var(--muted); font-size: 14px;">
                                <input type="checkbox" id="logs_autoscroll_panel" checked style="width: 16px; height: 16px;">
                                Auto-scroll
                            </label>
                            <select id="logs_filter_panel" class="filter-select" style="min-width: 150px;">
                                <option value="all">All logs</option>
                                <option value="error">Errors only</option>
                                <option value="app">App logs</option>
                                <option value="system">System logs</option>
                            </select>
                        </div>
                        <div style="color: var(--muted); font-size: 13px;" id="logs_status_panel">
                            Select a device to load logs
                        </div>
                    </div>
                    <div class="logs-viewport" id="logs_viewport_panel">
                        <div class="logs-content" id="logs_content_panel">
                            <div style="text-align: center; padding: 40px; color: var(--muted);">
                                Select a device to load logs.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
